<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home — CollabHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen font-sans">
  <script src="../js/api.js"></script>
  <script src="../js/app.js"></script>

  <nav class="fixed w-full z-50 bg-slate-900/95 backdrop-blur-xl border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 flex justify-between h-16 items-center">
      <a href="/" class="flex items-center space-x-2 text-white font-bold">CollabHub</a>
      <div class="flex items-center gap-4">
        <a href="/app/explore-startups" class="text-gray-300 hover:text-white">Explore</a>
        <a href="/app/network" class="text-gray-300 hover:text-white">Network</a>
        <a href="/app/profile" class="text-gray-300 hover:text-white">Profile</a>
      </div>
    </div>
  </nav>

  <main class="pt-28 pb-20 px-4">
    <div class="max-w-6xl mx-auto space-y-8">
      <header class="text-white">
        <h1 class="text-3xl font-bold">Home</h1>
        <p class="text-gray-400">Personalized feed and quick actions</p>
      </header>

      <div id="home-content" class="grid md:grid-cols-3 gap-8">
        <section id="home-left" class="md:col-span-2 space-y-6"></section>
        <aside id="home-right" class="space-y-6"></aside>
      </div>
    </div>
  </main>

  <script>
    if (!window.CollabHubAPI.isAuthenticated()) window.location.href = '/app/login?redirect=' + encodeURIComponent(window.location.href);

    const user = window.CollabHubAPI.getUserData();

    async function renderHome() {
      try {
        const stats = await window.CollabHubAPI.api.getDashboardStats();
        const interactions = await window.CollabHubAPI.api.getDashboardInteractions();
        const recommendations = await window.CollabHubAPI.api.getDashboardRecommendations();

        const left = document.getElementById('home-left');
        const right = document.getElementById('home-right');
        left.innerHTML = '';
        right.innerHTML = '';

        // Role-based sections
        if (user.role === 'founder') {
          left.innerHTML += `
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h2 class="text-lg font-semibold text-white">Startup stats</h2>
              <div class="mt-4 text-gray-300">Applications: ${stats.stats.total_applications || 0} • Teams: ${stats.stats.team_memberships || 0}</div>
            </div>
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h2 class="text-lg font-semibold text-white">Recent applications</h2>
              <div id="home-applications" class="mt-4 text-gray-300">Loading…</div>
            </div>
          `;

          right.innerHTML += `
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h3 class="text-white font-semibold">Updates</h3>
              <div class="text-gray-300 mt-3">Post updates from your startup detail page.</div>
            </div>
          `;

          const apps = interactions.interactions.filter(i => i.type === 'application');
          document.getElementById('home-applications').innerHTML = apps.length ? apps.map(a => `<div class="py-2 border-b border-white/5">${a.opportunity.title} — ${a.startup?.name || ''} • ${a.status}</div>`).join('') : '<div class="text-gray-400">No recent applications</div>';
        }

        if (user.role === 'talent' || user.role === 'student') {
          left.innerHTML += `
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h2 class="text-lg font-semibold text-white">Recommended startups</h2>
              <div id="home-recs" class="mt-4 text-gray-300">Loading…</div>
            </div>
          `;

          document.getElementById('home-recs').innerHTML = recommendations.results?.slice(0,6).map(r=>`<div class="py-2 border-b border-white/5">${r.name || r.title} • ${r.match_score ? r.match_score + '%' : ''}</div>`).join('') || '<div class="text-gray-400">No recommendations yet</div>';

          right.innerHTML += `
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h3 class="text-white font-semibold">Your interests</h3>
              <div class="text-gray-300 mt-3">${stats.interests_sent || 0} sent recently</div>
            </div>
          `;
        }

        if (user.role === 'investor') {
          left.innerHTML += `
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h2 class="text-lg font-semibold text-white">Trending startups</h2>
              <div id="home-trending" class="mt-4 text-gray-300">Loading…</div>
            </div>
          `;

          document.getElementById('home-trending').innerHTML = recommendations.results?.slice(0,6).map(r=>`<div class="py-2 border-b border-white/5">${r.name || r.title}</div>`).join('') || '<div class="text-gray-400">No trending startups</div>';

          right.innerHTML += `
            <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
              <h3 class="text-white font-semibold">Followed startups</h3>
              <div class="text-gray-300 mt-3">View your followed startups on your dashboard.</div>
            </div>
          `;
        }

      } catch (err) {
        console.error(err);
        showToast('Failed to load home feed', 'error');
      }
    }

    renderHome();
  </script>
</body>
</html>